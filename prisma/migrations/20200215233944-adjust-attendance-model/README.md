# Migration `20200215233944-adjust-attendance-model`

This migration has been generated by nampdn at 2/15/2020, 11:39:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_AttendanceAttendee" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_AttendanceAbsentee" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

ALTER TABLE "public"."Activity" ADD COLUMN "color" text   ;

ALTER TABLE "public"."Attendance" DROP COLUMN "member",
DROP COLUMN "present",
ADD COLUMN "group" text  NOT NULL ;

CREATE UNIQUE INDEX "_AttendanceAttendee_AB_unique" ON "public"."_AttendanceAttendee"("A","B")

CREATE UNIQUE INDEX "_AttendanceAbsentee_AB_unique" ON "public"."_AttendanceAbsentee"("A","B")

CREATE UNIQUE INDEX "Attendance_schedule" ON "public"."Attendance"("schedule")

ALTER TABLE "public"."_AttendanceAttendee" ADD FOREIGN KEY ("A") REFERENCES "public"."Attendance"("id") ON DELETE CASCADE

ALTER TABLE "public"."_AttendanceAttendee" ADD FOREIGN KEY ("B") REFERENCES "public"."Profile"("id") ON DELETE CASCADE

ALTER TABLE "public"."_AttendanceAbsentee" ADD FOREIGN KEY ("A") REFERENCES "public"."Attendance"("id") ON DELETE CASCADE

ALTER TABLE "public"."_AttendanceAbsentee" ADD FOREIGN KEY ("B") REFERENCES "public"."Profile"("id") ON DELETE CASCADE

ALTER TABLE "public"."Attendance" ADD FOREIGN KEY ("group") REFERENCES "public"."Group"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200209094458-attedance-slug..20200215233944-adjust-attendance-model
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Post {
   id        String   @default(cuid()) @id
@@ -45,9 +45,10 @@
   createdAt    DateTime     @default(now())
   updatedAt    DateTime     @updatedAt
   leader       Group[]      @relation(name: "GroupLeader")
   member       Group[]      @relation(name: "GroupMembers")
-  attendances  Attendance[] @relation(name: "AttendanceProfile")
+  attendee     Attendance[] @relation(name: "AttendanceAttendee")
+  absentee     Attendance[] @relation(name: "AttendanceAbsentee")
 }
 model Group {
   id        String    @default(cuid()) @id
@@ -79,27 +80,29 @@
   activities Activity[]
 }
 model Activity {
-  id   String @default(cuid()) @id
-  slug String @unique
-  name String
-  org  Org
+  id    String  @default(cuid()) @id
+  slug  String  @unique
+  name  String
+  color String?
+  org   Org
 }
 model Schedule {
-  id          String       @default(cuid()) @id
-  activity    Activity     @relation(name: "ScheduleActivity")
-  attendances Attendance[] @relation(name: "AttendanceSchedule")
-  date        DateTime
+  id         String     @default(cuid()) @id
+  activity   Activity   @relation(name: "ScheduleActivity")
+  attendance Attendance @relation(name: "AttendanceSchedule")
+  date       DateTime
 }
 model Attendance {
-  id        String   @default(cuid()) @id
-  slug      String   @unique
-  schedule  Schedule @relation(name: "AttendanceSchedule")
-  member    Profile  @relation(name: "AttendanceProfile")
+  id        String    @default(cuid()) @id
+  slug      String    @unique
+  group     Group     @relation(name: "AttendanceGroup")
+  schedule  Schedule  @relation(name: "AttendanceSchedule")
+  attendees Profile[] @relation(name: "AttendanceAttendee")
+  absentees Profile[] @relation(name: "AttendanceAbsentee")
   status    String
-  present   Boolean
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
 }
```


